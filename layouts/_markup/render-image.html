{{- $image := partial "helper/image" (dict "Resources" .Page.Resources "Image" .Destination) -}}
{{- $alt := .PlainText | safeHTML -}}
{{- $title := .Title | markdownify -}}

{{/* Theme helper returns empty string when resource not found; then avoid accessing .Height on string */}}
{{- with $image -}}
	{{- if .Permalink -}}
		{{- $galleryImage := and .Height .Width -}}
		<img src="{{ .Permalink }}"
			{{ with .Width }}width="{{ . }}"{{ end }}
			{{ with .Height }}height="{{ . }}"{{ end }}
			loading="lazy"
			{{ with $alt }}alt="{{ . }}"{{ end }}
			{{ with $title }}title="{{ . }}" data-title-escaped="{{ $title | htmlEscape }}"{{ end }}
			{{ if $galleryImage }}
				class="gallery-image"
				data-flex-grow="{{ div (mul .Width 100) .Height }}"
				data-flex-basis="{{ div (mul .Width 240) .Height }}px"
			{{ end }}>
	{{- else -}}
		<img src="{{ $.Destination | safeURL }}" loading="lazy"{{ with $alt }} alt="{{ . }}"{{ end }}>
	{{- end -}}
{{- else -}}
	<img src="{{ .Destination | safeURL }}" loading="lazy"{{ with $alt }} alt="{{ . }}"{{ end }}>
{{- end -}}
