{{ define "body-class" }}
    article-page
    {{- $TOCWidgetEnabled := false -}}
    {{- range .Site.Params.widgets.page -}}
        {{- if eq .type "toc" }}{{ $TOCWidgetEnabled = true }}{{ end -}}
    {{- end -}}
    {{- $TOCManuallyDisabled := eq .Params.toc false -}}
    {{- $TOCEnabled := and (not $TOCManuallyDisabled) $TOCWidgetEnabled -}}
    {{- $hasTOC := gt (len .TableOfContents) 50 -}}
    {{- .Scratch.Set "TOCEnabled" (and $TOCEnabled $hasTOC) -}}
    {{- .Scratch.Set "hasWidget" (and $TOCEnabled $hasTOC) -}}
{{ end }}

{{ define "main" }}
<article class="main-article {{ if .Params.image }}has-image{{ end }}">
  <header class="article-header">
    {{- $image := partial "helper/image" (dict "Image" .Params.image "Resources" .Resources) -}}
    {{ if $image }}
    <div class="article-image">
      <img src="{{ $image.Permalink }}" width="{{ $image.Width }}" height="{{ $image.Height }}" loading="eager" alt="Featured image: {{ .Title }}" />
    </div>
    {{ end }}
    <div class="article-details">
      <h1 class="article-title">{{ .Title }}</h1>
      {{ partial "article-authors.html" . }}
    </div>
  </header>

  <section class="article-content">
    {{ $wrappedTable := printf "<div class=\"table-wrapper\">${1}</div>" }}
    {{ .Content | replaceRE "(<table>(?:.|\n)+?</table>)" $wrappedTable | safeHTML }}
  </section>

  <div class="article-extra">
    {{ partial "discuss.html" . }}
    {{ partial "citation.html" . }}
  </div>
</article>

{{ partial "jsonld.html" . }}
{{ end }}

{{ define "right-sidebar" }}
  {{ if .Scratch.Get "hasWidget" }}{{ partial "sidebar/right.html" (dict "Context" . "Scope" "page") }}{{ end }}
{{ end }}
